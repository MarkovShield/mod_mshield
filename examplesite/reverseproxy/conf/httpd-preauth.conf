ServerName reverseproxy

<VirtualHost *:80>

    DocumentRoot "/var/www/html/"
    <Directory "/var/www/html/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    <Files ".ht*">
        Require all denied
    </Files>

    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>

    #################################################################################
    # LOGS
    #################################################################################
    # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.

    #ErrorLog "${APACHE_LOG_DIR}/error_log"
    LogLevel info rewrite:crit proxy:crit
    #LogLevel warn
    ErrorLog /dev/stderr
    TransferLog /dev/stdout

    #<IfModule log_config_module>

        #LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
        #LogFormat "%h %l %u %t \"%r\" %>s %b" common

        #<IfModule logio_module>
          # You need to enable mod_logio.c to use %I and %O
          #LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
        #</IfModule>

        #CustomLog "${APACHE_LOG_DIR}/access_log" common
        #CustomLog "${APACHE_LOG_DIR}/access_log" combined

    #</IfModule>

    #################################################################################
    #   Web Pre-Auth using Apache Module MOD_MSHIELD
    #################################################################################

    # Minimal required configuration
    MOD_MSHIELD_ENABLED                         On
    MOD_MSHIELD_CLIENT_REFUSES_COOKIES_URL      /error/refused_cookies.html
    MOD_MSHIELD_SESSION_FREE_URL                '(^/robots\.txt$)|(^/favicon\.ico$)|(^/static/)|(^/img/)|(^/error/)|(^/info)|(^/renew)|(^/en/)|(^/de/)|(^/js/)|(^/fonts/)|(^/css/)|(^/private/css/)'
    MOD_MSHIELD_SESSION_TIMEOUT_URL             /renew/renew.html
    MOD_MSHIELD_SESSION_DESTROY_URL             /logout/index.html
    MOD_MSHIELD_ALL_SHM_SPACE_USED_URL          /error/session_shm_used.html
    MOD_MSHIELD_GLOBAL_LOGON_SERVER_URL         /login/login.html
    MOD_MSHIELD_GLOBAL_LOGON_SERVER_URL_1       /login/login1.html
    MOD_MSHIELD_GLOBAL_LOGON_SERVER_URL_2       /login/login2.html

    # Additional configuration which is needed for example site docker container
    MOD_MSHIELD_SESSION_DESTROY                 '^/private/logout/'
    MOD_MSHIELD_AUTHORIZATION_ENABLED           On
    MOD_MSHIELD_COOKIE_SECURE                   Off
    MOD_MSHIELD_COOKIE_HTTPONLY                 Off
    MOD_MSHIELD_AUTHORIZED_LOGON_URL            '^/login/'

    MOD_MSHIELD_FRAUD_DETECTION_ENABLED         On
    MOD_MSHIELD_FRAUD_DETECTED_URL              /error/fraud_detected.html
    MOD_MSHIELD_FRAUD_ERROR_URL                 /error/fraud_error.html
    MOD_MSHIELD_KAFKA_BROKER                    mshield_kafka:9092
    MOD_MSHIELD_REDIS_SERVER                    mshield_redis
    MOD_MSHIELD_REDIS_PORT                      6379

    <Location /private>
        MOD_MSHIELD_LOGON_REQUIRED  On
        ProxyPass   http://mshield_backend:8888/
    </Location>

    <Location /private/chat>
        MOD_MSHIELD_LOGON_REQUIRED  On
        ProxyPass   http://mshield_backend:8888/
    </Location>

    <Location /private/request-header>
        MOD_MSHIELD_LOGON_REQUIRED  On
        ProxyPass   http://mshield_backend:8888/
    </Location>

    #################################################################################
    #   MOD_REWRITE
    #################################################################################
    RewriteEngine On
    #LogLevel alert rewrite:trace4
    #RewriteCond %{HTTPS} off
    RewriteRule ^/private/(.*) https://%{HTTP_HOST}%{REQUEST_URI}

</VirtualHost>
